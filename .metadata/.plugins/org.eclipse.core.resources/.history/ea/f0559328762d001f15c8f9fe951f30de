$("[name='send']").off().on("click", function() {
	var subject = "sbb 회원인증번호 입니다.";
	var body = "안녕하세요 sbb 입니다. \n 인증번호 : ";
	var email = $("[id='email']").val();

	var params = {
		email: email
		, subject: subject
		, body: body
	}

	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	$(function() {
		$(document).ajaxSend(function(e, xhr, options) {
			xhr.setRequestHeader(header, token);
		});
	});
	$.ajax({
		url: "/email/idfind"
		, beforeSend: function(xhr) {
			xhr.setRequestHeader(header, token);
		}
		, type: "POST"
		, contentType: "application/json; charset=utf-8"
		, data: JSON.stringify(params)
		, dataType: "json"
		, success: function(data) {
			alert("이메일 전송에 성공하였습니다.");
			takeTarget();
		},

		error: function(jqXHR, textStatus, errorThrown) {
			alert(jqXHR.responseJSON.message);
		}
	});
});


// 인증번호 확인
$("[name='authcheck']").off().on("click", function() {
	var email = $("[id='email']").val();
	var serial = $("[id='auth']").val();
	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	$(function() {
		$(document).ajaxSend(function(e, xhr, options) {
			xhr.setRequestHeader(header, token);
		});
	});

	var params = {
		email: email
		, serial: serial
	}

	$.ajax({
		url: "/check/idfind"
		, beforeSend: function(xhr) {
			xhr.setRequestHeader(header, token);
		}
		, type: "POST"
		, contentType: "application/json; charset=utf-8"
		, data: JSON.stringify(params)
		, dataType: "text"
		, success: function(data) {
			if (data != 0) {
				alert("인증에 성공하였습니다.");
				var _html = "";
				_html += '<label for="findid" class="form-label" style="display: flex;">id는 ' + data + ' 입니다.</label>';
				_html += '<button type="button" class="btn btn-primary" onclick="location.href=\'/user/login\'">로그인</button>'+
'<button type="button" class="btn btn-primary" onclick="location.href=\'/user/idfind\'">비밀번호 찾기</button>';
				$("[name='delete_area']").remove();
				$("[name='append_area']").html(_html);
			} else {
				alert("인증에 실패하였습니다.");
			}
		},

		error: function(jqXHR, textStatus, errorThrown) {
			alert("인증에 실패하였습니다.");
		}
	});
});

//타이머
const remainingMin = document.getElementById("remaining__min");
const remainingSec = document.getElementById("remaining__sec");
const completeBtn = document.getElementById("authcheck");

let time = 300;
const takeTarget = () => {
	setInterval(function() {
		if (time > 0) { // >= 0 으로하면 -1까지 출력된다.
			completeBtn.disabled = false;
			time = time - 1; // 여기서 빼줘야 3분에서 3분 또 출력되지 않고, 바로 2분 59초로 넘어간다.
			let min = Math.floor(time / 60);
			let sec = String(time % 60).padStart(2, "0");
			remainingMin.innerText = min;
			remainingSec.innerText = sec;
			// time = time - 1
		} else {
			completeBtn.disabled = true;
		}
	}, 1000);
};