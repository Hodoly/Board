//인증번호 메일발송
$("[name='send']").off().on("click", function() {
	var subject = "sbb 회원인증번호 입니다.";
	var body = "안녕하세요 sbb 입니다. \n 인증번호 : ";
	var username = $("[id='username']").val();

	var params = {
		username: username
		, subject: subject
		, body: body
	}

	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	$(function() {
		$(document).ajaxSend(function(e, xhr, options) {
			xhr.setRequestHeader(header, token);
		});
	});
	$.ajax({
		url: "/email"
		, beforeSend: function(xhr) {
			xhr.setRequestHeader(header, token);
		}
		, type: "POST"
		, contentType: "application/json; charset=utf-8"
		, data: JSON.stringify(params)
		, dataType: "json"
		, success: function(data) {
			alert("이메일 전송에 성공하였습니다.");
			$("[name='username']").attr("readonly", true)
			takeTarget();
		},

		error: function(jqXHR, textStatus, errorThrown) {
			alert("이메일 전송에 실패하였습니다.");
		}
	});
});
// 인증번호 확인
$("[name='authcheck']").off().on("click", function() {
	var username = $("[id='username']").val();

	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	$(function() {
		$(document).ajaxSend(function(e, xhr, options) {
			xhr.setRequestHeader(header, token);
		});
	});
	$.ajax({
		url: "/check"
		, beforeSend: function(xhr) {
			xhr.setRequestHeader(header, token);
		}
		, type: "POST"
		, contentType: "application/json; charset=utf-8"
		, data: username
		, dataType: "text"
		, success: function(data) {
			debugger;
		},

		error: function(jqXHR, textStatus, errorThrown) {
			alert("이메일 전송에 실패하였습니다.");
		}
	});
});

//타이머
const remainingMin = document.getElementById("remaining__min");
const remainingSec = document.getElementById("remaining__sec");
const completeBtn = document.getElementById("authcheck");

let time = 180;
const takeTarget = () => {
  setInterval(function () {
    if (time > 0) { // >= 0 으로하면 -1까지 출력된다.
      time = time - 1; // 여기서 빼줘야 3분에서 3분 또 출력되지 않고, 바로 2분 59초로 넘어간다.
      let min = Math.floor(time / 60);
      let sec = String(time % 60).padStart(2, "0");
      remainingMin.innerText = min;
      remainingSec.innerText = sec;
      // time = time - 1
    } else {
      completeBtn.disabled = true;
    }
  }, 1000);
};